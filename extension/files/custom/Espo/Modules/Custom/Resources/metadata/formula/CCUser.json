{
    "beforeSaveCustomScript": "if (isActive == true) {\n    if (!record\\exists('User', 'emailAddress=', emailAddress)) {\n        $password = password\\generate();\n        $hash = password\\hash($password);\n        \n        $userId = record\\create('User',\n            'userName', userName,\n            'name', name,\n            'firstName', firstName,\n            'lastName', lastName,\n            'gender', gender,\n            'password', $hash,\n            'emailAddress', emailAddress,\n            'phoneNumber', phoneNumber,\n            'teams', teams\n        );\n        \n        $volunteerRole = record\\findOne('Role', 'createdAt', 'desc', 'name=', 'Volunteer');\n        record\\relate('User', $userId, 'roles', list($volunteerRole));\n        \n        $emailBody = string\\concatenate(\n            'Username: ', userName, '\\n',\n            'Password: ', $password, '\\n'\n        );\n        \n        $emailId = record\\create(\n            'Email',\n            'to', emailAddress,\n            'status', 'Sending',\n            'subject', 'Access info',\n            'body', $emailBody,\n            'isHtml', false\n        );\n        \n        ext\\email\\send($emailId);\n    } else {\n        $userId = record\\findOne('User', 'createdAt', 'desc', 'emailAddress=', emailAddress);\n        record\\update('User', $userId,\n            'userName', userName,\n            'name', name,\n            'firstName', firstName,\n            'lastName', lastName,\n            'gender', gender,\n            'phoneNumber', phoneNumber,\n            'teams', teams,\n            'isActive', true\n        );\n    }\n}\n\nif (isActive == false) {\n    if (record\\exists('User', 'emailAddress=', emailAddress)) {\n        $userId = record\\findOne('User', 'createdAt', 'desc', 'emailAddress=', emailAddress);\n        record\\update('User', $userId,\n            'isActive', false\n        );\n    }\n}\n\nif (resetPassword == true) {\n    $password = password\\generate();\n    $hash = password\\hash($password);\n    \n    $userId = record\\findOne('User', 'createdAt', 'desc', 'emailAddress=', emailAddress);\n    record\\update('User', $userId,\n            'password', $hash,\n        );\n        \n    $emailBody = string\\concatenate(\n            'Username: ', userName, '\\n',\n            'Password: ', $password, '\\n'\n        );\n        \n    $emailId = record\\create(\n            'Email',\n            'to', emailAddress,\n            'status', 'Sending',\n            'subject', 'Access info',\n            'body', $emailBody,\n            'isHtml', false\n        );\n        \n    ext\\email\\send($emailId);\n    resetPassword = false;\n}"
}